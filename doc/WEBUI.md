# Web UI

The web UI serves the same purpose as the CLI, namely perform device and
key management operations for a fleet of remote devices.

Each client devices has an identifier and a secret key, shared with the
key management server (C2). In addition, each client is associated with
one or more topics, where each topic has a name and a dedicated key.

Keys are 32-byte and encoded in hexadecimal in HTTP requests. Of course
these requests will be sent over TLS.

Two types of users are considered: standard user and admin.
The operations to be performed are essentially CRUD operations on a
database of keys, where each client name and each topic name is
associated with a unique key.

## Standard user operations

A standard user should be able to perform the following operations:

### Client management operations

* **Register a new client**, by entering its name (string) and
  optionally a key. If no key is provided, one is generated using a cryptographic
  PRNG available from the browser (recommended:
  [`Crypto.getRandomValues()`](https://developer.mozilla.org/en-US/docs/Web/API/Crypto/getRandomValues)).

* **Delete a client**, by entering its identifie

* **Update the key of a client**, by entering the client identifier and
  optionally a key. If no key is provided then one is generated.

HTTP requests used for these operations are respectively

* POST /e4/client/{id}/key/{key}: `new_client(id, key)`

* DELETE /e4/client/{id}: `remove_client(id)`

* PATCH /e4/client/{id}/: `new_client_key(id)` 

These operations only modify the server database, and do not trigger a
control message sent to a remote client.

## Topic management operations

* **Register a new topic**, by entering the topic name. A key is
  automatically generated by the client.

* **Delete a topic** by entering the topic name.

HTTP requests used for these operations are respectively:

* POST /e4/topic/{topic}: `new_topic(topic)`

* DELETE /e4/topic/{topic}: `remove_topic(topic)` 

These operations only modify the server database, and do not trigger a
control message sent to a remote client.

## Topic/client association management

* **Associate a client to a topic**

* **Remove a topic associated to a client**

* **Remove all topics associated to a client**

HTTP requests used for these operations are respectively:

* PUT /e4/client/{id}/topic/{topic}: `new_topic_client(id, topic)`

* DELETE /e4/client/{id}/topic/{topic}: `remove_topic_client(id, topic)`

* PUT /e4/client/{id}: `reset_client(id)` 

## Admin operations

An admin should be able to manage users of the application, in addition
to the standard user operations.

## File-based mode

As an alternative to manual operations, a user should be able to upload
a file with a list of operations (and their arguments), such that each
line corresponds to an operation.

## UI concerns

The UI should show the following visual elements (not necessarily on the
same page)

* Dashboard showing metrics (number of clients in the DB, number of
  topics, number of clients with no topic key, 

* A log of the most recent operations performed.

* Tables listing clients and their associated topics (and the other way
  around), searchable by name, sortable by number of topics, etc. With a
  button or other visual element to delete an entry, add topics, etc.

## Other requirements

The application must be served over TLS properly configured, and should
connect to the C2 service using TLS as well.

The app should be optimized for desktop browsers but be compatible with
mobile browsers.


## REST API

E4 C2 API:

* POST /e4/client/{id}/key/{key}: `new_client(id, key)`

* DELETE /e4/client/{id}: `remove_client(id)`

* PUT /e4/client/{id}/topic/{topic}: `new_topic_client(id, topic)`

* DELETE /e4/client/{id}/topic/{topic}: `remove_topic_client(id, topic)`

* PUT /e4/client/{id}: `reset_client(id)` 

* POST /e4/topic/{topic}: `new_topic(topic)`

* DELETE /e4/topic/{topic}: `remove_topic(topic)` 

* PATCH /e4/client/{id}/: `new_client_key(id)` 

Other endpoints:

* GET /e4/topic/: lists of all topics

* GET /e4/client/: lists all client ids

* GET /e4/client/{id}: lists the topics support by id

* GET /e4/topic/{topic}: lists the ids supporting topic


